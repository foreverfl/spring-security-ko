[[servlet-authentication-basic]]
= 기본 인증
:figures: servlet/authentication/unpwd

이 섹션에서는 Spring Security가 서블릿 기반 애플리케이션을 위한 기본 HTTP 인증을 어떻게 지원하는지 자세히 설명합니다.

이 섹션에서는 Spring Security 내에서 HTTP 기본 인증이 어떻게 작동하는지 설명합니다.
먼저, 인증되지 않은 클라이언트에게 WWW-Authenticate 헤더가 어떻게 전송되는지 살펴보겠습니다:

.WWW-Authenticate 헤더 전송
image::{figures}/basicauthenticationentrypoint.png[]

위 그림은 `SecurityFilterChain` 다이어그램을 기반으로 합니다.

image:{icondir}/number_1.png[] 먼저, 사용자가 권한이 없는 리소스 ``/private``에 대해 인증되지 않은 요청을 합니다.

image:{icondir}/number_2.png[] Spring Security의 ``AuthorizationFilter``가 인증되지 않은 요청이 거부되었음을 ``AccessDeniedException``을 던져 표시합니다.

image:{icondir}/number_3.png[] 사용자가 인증되지 않았으므로, ``ExceptionTranslationFilter``가 인증 시작을 초기화합니다.
구성된 ``AuthenticationEntryPoint``는 ``BasicAuthenticationEntryPoint``의 인스턴스로, WWW-Authenticate 헤더를 전송합니다.
``RequestCache``는 일반적으로 ``NullRequestCache``로, 클라이언트가 원래 요청한 요청을 재생할 수 있기 때문에 요청을 저장하지 않습니다.

클라이언트가 `WWW-Authenticate` 헤더를 받으면 사용자 이름과 비밀번호로 다시 시도해야 한다는 것을 알게 됩니다.
다음 이미지는 사용자 이름과 비밀번호가 처리되는 흐름을 보여줍니다:

[[servlet-authentication-basicauthenticationfilter]]
.사용자 이름과 비밀번호 인증
image::{figures}/basicauthenticationfilter.png[]

위 그림은 `SecurityFilterChain` 다이어그램을 기반으로 합니다.

image:{icondir}/number_1.png[] 사용자가 사용자 이름과 비밀번호를 제출하면, ``BasicAuthenticationFilter``가 ``HttpServletRequest``에서 사용자 이름과 비밀번호를 추출하여 ``UsernamePasswordAuthenticationToken``을 생성합니다. 이는 ``Authentication``의 한 유형입니다.

image:{icondir}/number_2.png[] 다음으로, ``UsernamePasswordAuthenticationToken``이 인증을 위해 ``AuthenticationManager``로 전달됩니다.
``AuthenticationManager``의 구체적인 모습은 사용자 정보가 어떻게 저장되어 있는지에 따라 다릅니다.

image:{icondir}/number_3.png[] 인증이 실패하면 다음과 같은 실패 처리가 이루어집니다.

. ``SecurityContextHolder``가 초기화됩니다.
. ``RememberMeServices.loginFail``이 호출됩니다. Remember me가 구성되지 않았다면 이는 아무 작업도 하지 않습니다.
. ``AuthenticationEntryPoint``가 호출되어 WWW-Authenticate가 다시 전송되도록 트리거됩니다.

image:{icondir}/number_4.png[] 인증이 성공하면 다음과 같은 성공 처리가 이루어집니다.

. ``Authentication``이 ``SecurityContextHolder``에 설정됩니다.
. ``RememberMeServices.loginSuccess``가 호출됩니다. Remember me가 구성되지 않았다면 이는 아무 작업도 하지 않습니다.
. ``BasicAuthenticationFilter``가 ``FilterChain.doFilter(request,response)``를 호출하여 나머지 애플리케이션 로직을 계속 진행합니다.

기본적으로 Spring Security의 HTTP 기본 인증 지원은 활성화되어 있습니다.
그러나 서블릿 기반 구성이 제공되는 즉시 HTTP 기본 인증을 명시적으로 제공해야 합니다.

다음 예제는 최소한의 명시적 구성을 보여줍니다:

.명시적 HTTP 기본 구성
[tabs]
======
Java::
+
[source,java,role="primary"]
----
@Bean
public SecurityFilterChain filterChain(HttpSecurity http) {
	http
		// ...
		.httpBasic(withDefaults());
	return http.build();
}
----

XML::
+
[source,xml,role="secondary"]
----
<http>
	<!-- ... -->
	<http-basic />
</http>
----

Kotlin::
+
[source,kotlin,role="secondary"]
----
@Bean
open fun filterChain(http: HttpSecurity): SecurityFilterChain {
	http {
		// ...
		httpBasic { }
	}
	return http.build()
}
----
======